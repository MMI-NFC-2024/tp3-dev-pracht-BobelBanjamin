---
import Layout from "../layouts/Layout.astro";
---

<Layout>
  <div class="container mx-auto px-4 py-8">
    <h1 class="text-3xl font-bold text-center mb-8">Visualisation par Iframe</h1>
    
    <nav class="mb-8">
      <div class="flex space-x-6 justify-center items-center bg-gray-100 p-4 rounded-lg">
        <div class="flex items-center space-x-2">
          <label for="species-select" class="text-gray-600">Espèce:</label>
          <select id="species-select" class="px-3 py-1 border border-gray-300 rounded-md bg-white text-gray-700 hover:border-blue-500 focus:outline-none focus:border-blue-500">
            <option value="Adelieiframe" selected>Adelie</option>
            <option value="Gentooiframe">Gentoo</option>
            <option value="Chinstrapiframe">Chinstrap</option>
          </select>
        </div>
        
        <span class="text-gray-400">|</span>
        <a href="/" class="text-gray-600 hover:text-blue-600 transition-colors">Accueil</a>
        <a href="/anchors/" class="text-gray-600 hover:text-blue-600 transition-colors">Ancres</a>
      </div>
    </nav>
    
    <div class="border-2 border-gray-200 rounded-lg overflow-hidden shadow-lg">
      <iframe 
        name="species-frame" 
        src="/speciesi-frame/Adelieiframe/" 
        class="w-full"
        style="height: 600px; border: none;"
        id="species-iframe"
        onload="resizeIframe(this)">
      </iframe>
    </div>
    
    <div class="mt-8 bg-blue-50 p-6 rounded-lg">
      <h3 class="text-lg font-semibold mb-3">Navigation par Iframe</h3>
      <p class="text-gray-700">
        Cette page utilise une iframe pour afficher les différentes espèces de manchots. 
        Utilisez le sélecteur du menu pour charger les différentes pages dans l'iframe ci-dessus.
        L'iframe se redimensionne automatiquement selon le contenu.
      </p>
    </div>
  </div>
</Layout>

<script>
  function resizeIframe(iframe) {
    try {
      // Attendre un peu pour que le contenu soit complètement chargé
      setTimeout(() => {
        const iframeDocument = iframe.contentDocument || iframe.contentWindow.document;
        const height = Math.max(
          iframeDocument.body.scrollHeight,
          iframeDocument.body.offsetHeight,
          iframeDocument.documentElement.clientHeight,
          iframeDocument.documentElement.scrollHeight,
          iframeDocument.documentElement.offsetHeight
        );
        iframe.style.height = Math.max(height + 50, 600) + 'px';
      }, 100);
    } catch (e) {
      // En cas d'erreur (cross-origin par exemple), garder la hauteur par défaut
      iframe.style.height = '600px';
    }
  }
  
  // Gestion du changement d'espèce dans le select
  document.querySelector("#species-select")?.addEventListener("change", (evt) => {
    const value = (evt.target as HTMLSelectElement).value;
    const iframe = document.getElementById("species-iframe") as HTMLIFrameElement;
    if (iframe && value) {
      iframe.src = "/speciesi-frame/" + value + "/";
    }
  });
  
  // Redimensionner également au changement de contenu
  window.addEventListener('message', function(e) {
    if (e.data.type === 'resize') {
      const iframe = document.getElementById('species-iframe');
      if (iframe) {
        resizeIframe(iframe);
      }
    }
  });
</script>